#How mbed Works

The mbed hardware architecture is designed to give you a really reliable and accessible platform to be able to quickly pick up and prototype with, whilst giving you bare-metal access to the underlying target microcontroller without needing any form of bootloader or monitor. Here is how it works...

##Architecture diagram

This is the basic architecture of the mbed Microcontroller board:

<span style="text-align:center; display:block;">
![](/Getting_Started/Images/mbed_Interface.webp)
</span>

##How programming works

When you plug in an mbed Microcontroller in to your PC using USB, it appears like a USB flash disk. This small disk is presented by the mbed Interface, and allows you to save ARM microcontroller binaries you want to run directly on to the mbed, without needing drivers. Note that when you save a binary file to the mbed disk, it is not immediately loaded in to the internal microcontroller FLASH memory. 

When you hit reset, the [mbed interface](/Introduction/mbed_Interface/) looks at the disk for the newest .bin file it can find. If there is a new file, it will load it in to the microcontroller's internal FLASH memory using the JTAG interface. If the newest binary is already loaded, it won't load it again. It then starts the microcontroller running. 

This means if you hit reset again, it will simply reset the target microcontroller and start it running again, as the latest binary is already loaded. 

If there is no binary on the mbed disk, the target microcontroller will simply be kept held in reset.

##How USB serial works

The mbed Interface also presents a USB serial/com interface. This is basically a UART-USB bridge, and connects to UART0 of the interface. So if you send characters out of UART0 of the target microcontroller, they will be read by the mbed interface and transfered over the USB link. When you printf(), it is just sendin characters to UART0. This means if you make your own PCB, these characters will still appear on UART0. 

##How the LocalFileSystem works

Because we have a USB disk, we also thought it'd be really useful to let you read and write files to it from the target microcontroller. To do this, the mbed Interface acts like a host debugger and listens out for filesystem "semihosting" requests via JTAG. 

##Notes

The USB interface used for programming the microcontroller is not using the USB interface of the target LPC1768 microcontroller. This means the target USB interface is still available on the mbed pins (D+, D-), allowing your applications to have their own USB interfaces. 

The .bin files the mbed Microcontroller accepts are standard raw ARM binaries, and can be generated by any compiler you like. You have bare-metal control of the target microcontroller, as the separate interface manages programming over JTAG i.e. we don't use a bootloader or monitor on the target. So you really are just loading on a raw binary. This means you can build your own PCB using the same target microcontroller, and the same program binary will run on that. 


# The mbed Interface

Since the beginning of mbed, there has been a certain amount of interest and speculation around the "magic interface chip" on the underside of the mbed microcontroller.

There has been some information published surrounding this part, which is now collated on this page.

The full schematics of the mbed Microcontroller, including the mbed interface are now available in the handbook.

##Connectivity

The best representation of the connectivity of the mbed interface was in Simon's official unoffical diagram:

<span style="text-align:center; display:block;">
![](/Getting_Started/Images/mbed_Interface.webp)
</span>

The headlines are that it:

- Provides a USB connection to the host computer, which exposes a Mass Storage (flash disk) and a USB Serial Port

- Connects with the Serial Flash device, which implements the USB flash disk file storage

- Has a JTAG connection to the target, so that it can program the target flash. Semihosting of the USB flash drive (LocalFileSystem) is implemented over this JTAG connection

- A physical UART connection exists between the target and the interface which is relayed over interface USB Serial port

##Operation

There are a few facts and rules about how the interface interacts with the host computer and the target, the most significant ones are:

- The USB Drive is really a flash drive that can store multiple binary files. On power up/reset, the interface will always program the newest file into the target, unless the newest binary has already been programmed.

- When there is no binary file on the USB flash disk, the target is held in reset

- The reset button on the mbed Microcontroller doesn't directly resets the target. Instead it requests that the interface resets the target, checking first to see if there is a newer binary on the USB flash disk to be programmed.

- If a file is opened by the target using LocalFileSystem, the USB flash disk will disappear from the host computer until the file is closed, as the filesystem can not appear in two places at once. 

- Should the USB flash drive fail to appear when you plug in your mbed, it might be because your current program is using the local file system. Press and hold the reset button to keep the target in reset, and the flash drive will appear.

