## Analyzing Mbed-OS crash dump
This tutorial explains the crash dump generation in Mbed-OS and how to analyze the crash dump data.

### Crash dump generation on fault exception
When the system crashes due to fault exceptions, Mbed-OS fault exception handler will be invoked and 
will generate a crash dump containing register context and current thread information. This information 
will be printed out to your serial terminal. The register context generated will be the state of registers 
at the instance when the exception was triggered. The following Cortex-M fault exceptions will trigger the 
Mbed-OS fault exception handler. 

1. HardFault Exception
2. MemManage Exception
3. BusFault Exception
4. UsageFault Exception

The exceptions supported on your platform will depend on the specific Cortex-M core you have in your system. 
For example, Cortex-M0(or any ARMv6M cores) cores will not have MemManage, BusFault, UsageFault exceptions 
implemented. In those cases, all exceptions will be reported as HardFault exception. Please look into 
**Technical Reference Manual** and **ARM Architecture Reference Manual** documents to find out more information 
on exceptions supported for the specific core you have in your system.

Below shows an example of crash dump generated by Mbed-OS fault exception handler. 

```
++ MbedOS Fault Handler ++

FaultType: HardFault

Context:
R0   : 0000C158
R1   : 00000000
R2   : E000ED00
R3   : 0000AAA3
R4   : 0000C182
R5   : 00000000
R6   : 00000000
R7   : 00000000
R8   : 00000000
R9   : 00000000
R10  : 00000000
R11  : 00000000
R12  : FFFFFFFF
SP   : 20002E98
LR   : 00001799
PC   : 00001774
xPSR : 210F0000
PSP  : 20002E30
MSP  : 2002FFD8
CPUID: 410FC241
HFSR : 40000000
MMFSR: 00000000
BFSR : 00000000
UFSR : 00000100
DFSR : 00000008
AFSR : 00000000
SHCSR: 00000000

Thread Info:
Current:
State: 00000002 EntryFn: 00002595 Stack Size: 00001000 Mem: 20001EA0 SP: 20002E60
Next:
State: 00000002 EntryFn: 00002595 Stack Size: 00001000 Mem: 20001EA0 SP: 20002E60
Wait Threads:
State: 00000083 EntryFn: 00004205 Stack Size: 00000300 Mem: 20000E18 SP: 200010B0
Delay Threads:
Idle Thread:
State: 00000001 EntryFn: 00002715 Stack Size: 00000200 Mem: 20001118 SP: 200012D8

-- MbedOS Fault Handler -- 
```

### Analyzing crash dump
As in the example shown above, you can see that the crash dump indicates the fault exception type(see **FaultType**), 
the register context(see **Context**) at the time of exception and the current threads(see **Thread Info**) in the 
system along with their stack information.

The register context contains key information to determine the cause and location of crash. For example, you can use
**PC** value to find the location of the crash and **LR** to find the caller of the function where the crash occurred.
Note that the **LR** value may or may not reflect the actual caller depending on how the function is invoked. You can
use the linker address map generated during the build to find the name of function from the **PC** value. The other 
key information in the register context is fault status register values(**HFSR, MMFSR, UFSR, BFSR**). The values in 
these registers indicate the cause of exception. Please look into **Technical Reference Manual** and 
**ARM Architecture Reference Manual** documents to find out more information on how to interpret these registers.

The thread info section is split into five sections corresponding to the state of the thread. For each thread: state 
of the thread(**State**), entry function address(**EntryFn**), stack size(**Stack Size**), stack top(**Mem**) and 
current stack pointer(**SP**) will be reported. You can use the linker address map to find the thread entry function 
from the **EntryFn** value. You can also use the stack size(**Stack Size**), stack top(**Mem**) and current stack pointer(**SP**)  
value to determine if there is thread stack overflow. For example, if **SP** value is smaller than **Mem** value, it indicates
stack overflow for that thread.

### Crash dump analyzer script
A convenience script, named **crash_log_parser**, has been provided to help analyze crash data. 
Please look at the [documentation for crash_log_parser](/docs/v5.8/tools/debug/crash_dump_analyzer.html) to get more information.
